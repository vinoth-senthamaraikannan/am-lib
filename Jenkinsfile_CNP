#!groovy

@Library("Infrastructure")

def type = "java"
def product = "am"
def component = "lib-test"

withPipeline(type, product, component) {
  setVaultName('am')
  enableDockerBuild()
  installCharts()
  enableDbMigration()

  onMaster {
    enableSlackNotifications('#am-master-builds')
  }

  onPR {
    // channel won't be used instead the user channel configured here is used:
    // https://github.com/hmcts/github-slack-user-mappings
    enableSlackNotifications('#am-pr-builds')
  }

  after('smoketest:aat') {
    echo "Disabling prod build"
    sh "rm -rf infrastructure/"
  }
}
